{"ast":null,"code":"import{useState,useCallback,useEffect}from\"react\";import{jwtDecode}from'jwt-decode';let logoutTimer;export const useAuth=()=>{const[token,setToken]=useState(false);const[tokenExpirationDate,setTokenExpirationDate]=useState();const[userId,setUserId]=useState(false);const login=useCallback((userId,token,expirationDate)=>{setToken(token);setUserId(userId);const jwtDecodedData=jwtDecode(token);const renewedDate=expirationDate||new Date(new Date().getTime()+jwtDecodedData.expireTime);setTokenExpirationDate(renewedDate);localStorage.setItem(\"userData\",JSON.stringify({userId,token,expiration:renewedDate.toISOString()}));},[]);const logout=useCallback(()=>{setToken(null);setTokenExpirationDate(null);setUserId(null);// console.log('Logout')\nlocalStorage.removeItem(\"userData\");},[]);useEffect(()=>{if(token&&tokenExpirationDate){const remainingTime=tokenExpirationDate.getTime()-new Date().getTime();logoutTimer=setTimeout(logout,remainingTime);}else{clearTimeout(logoutTimer);}},[token,logout,tokenExpirationDate]);useEffect(()=>{const storedData=JSON.parse(localStorage.getItem(\"userData\"));if(storedData&&storedData.token&&new Date(storedData.expiration)>new Date()){login(storedData.userId,storedData.token,new Date(storedData.expiration));}},[login]);return{userId,token,login,logout};};","map":{"version":3,"names":["useState","useCallback","useEffect","jwtDecode","logoutTimer","useAuth","token","setToken","tokenExpirationDate","setTokenExpirationDate","userId","setUserId","login","expirationDate","jwtDecodedData","renewedDate","Date","getTime","expireTime","localStorage","setItem","JSON","stringify","expiration","toISOString","logout","removeItem","remainingTime","setTimeout","clearTimeout","storedData","parse","getItem"],"sources":["C:/Users/IMWONHYEOK/study/react/section_13_front/src/shared/hooks/auth-hook.js"],"sourcesContent":["import { useState, useCallback, useEffect } from \"react\";\nimport {jwtDecode} from 'jwt-decode';\n\nlet logoutTimer;\n\nexport const useAuth = () => {\n  const [token, setToken] = useState(false);\n  const [tokenExpirationDate, setTokenExpirationDate] = useState();\n  const [userId, setUserId] = useState(false);\n\n  const login = useCallback((userId, token, expirationDate) => {\n    setToken(token);\n    setUserId(userId);\n    const jwtDecodedData = jwtDecode(token);\n    \n    const renewedDate =\n      expirationDate || new Date(new Date().getTime() + jwtDecodedData.expireTime);\n    setTokenExpirationDate(renewedDate);\n\n    localStorage.setItem(\"userData\", JSON.stringify({\n      userId,\n      token,\n      expiration: renewedDate.toISOString()\n    }));\n  }, [])\n\n  const logout = useCallback(() => {\n    setToken(null);\n    setTokenExpirationDate(null);\n    setUserId(null);\n    // console.log('Logout')\n    localStorage.removeItem(\"userData\");\n  }, [])\n\n  useEffect(() => {\n    if (token && tokenExpirationDate) {\n      const remainingTime = tokenExpirationDate.getTime() - new Date().getTime();\n      logoutTimer = setTimeout(logout, remainingTime);\n    } else {\n      clearTimeout(logoutTimer);\n    }\n  }, [token, logout, tokenExpirationDate]);\n\n  useEffect(() => {\n    const storedData = JSON.parse(localStorage.getItem(\"userData\"));\n    if (\n      storedData &&\n      storedData.token &&\n      (new Date(storedData.expiration) > new Date())\n    ) {\n      login(storedData.userId, storedData.token, new Date(storedData.expiration));\n    }\n  }, [login])\n\n  return { userId, token, login, logout};\n};"],"mappings":"AAAA,OAASA,QAAQ,CAAEC,WAAW,CAAEC,SAAS,KAAQ,OAAO,CACxD,OAAQC,SAAS,KAAO,YAAY,CAEpC,GAAI,CAAAC,WAAW,CAEf,MAAO,MAAM,CAAAC,OAAO,CAAGA,CAAA,GAAM,CAC3B,KAAM,CAACC,KAAK,CAAEC,QAAQ,CAAC,CAAGP,QAAQ,CAAC,KAAK,CAAC,CACzC,KAAM,CAACQ,mBAAmB,CAAEC,sBAAsB,CAAC,CAAGT,QAAQ,CAAC,CAAC,CAChE,KAAM,CAACU,MAAM,CAAEC,SAAS,CAAC,CAAGX,QAAQ,CAAC,KAAK,CAAC,CAE3C,KAAM,CAAAY,KAAK,CAAGX,WAAW,CAAC,CAACS,MAAM,CAAEJ,KAAK,CAAEO,cAAc,GAAK,CAC3DN,QAAQ,CAACD,KAAK,CAAC,CACfK,SAAS,CAACD,MAAM,CAAC,CACjB,KAAM,CAAAI,cAAc,CAAGX,SAAS,CAACG,KAAK,CAAC,CAEvC,KAAM,CAAAS,WAAW,CACfF,cAAc,EAAI,GAAI,CAAAG,IAAI,CAAC,GAAI,CAAAA,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC,CAAGH,cAAc,CAACI,UAAU,CAAC,CAC9ET,sBAAsB,CAACM,WAAW,CAAC,CAEnCI,YAAY,CAACC,OAAO,CAAC,UAAU,CAAEC,IAAI,CAACC,SAAS,CAAC,CAC9CZ,MAAM,CACNJ,KAAK,CACLiB,UAAU,CAAER,WAAW,CAACS,WAAW,CAAC,CACtC,CAAC,CAAC,CAAC,CACL,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAC,MAAM,CAAGxB,WAAW,CAAC,IAAM,CAC/BM,QAAQ,CAAC,IAAI,CAAC,CACdE,sBAAsB,CAAC,IAAI,CAAC,CAC5BE,SAAS,CAAC,IAAI,CAAC,CACf;AACAQ,YAAY,CAACO,UAAU,CAAC,UAAU,CAAC,CACrC,CAAC,CAAE,EAAE,CAAC,CAENxB,SAAS,CAAC,IAAM,CACd,GAAII,KAAK,EAAIE,mBAAmB,CAAE,CAChC,KAAM,CAAAmB,aAAa,CAAGnB,mBAAmB,CAACS,OAAO,CAAC,CAAC,CAAG,GAAI,CAAAD,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC,CAC1Eb,WAAW,CAAGwB,UAAU,CAACH,MAAM,CAAEE,aAAa,CAAC,CACjD,CAAC,IAAM,CACLE,YAAY,CAACzB,WAAW,CAAC,CAC3B,CACF,CAAC,CAAE,CAACE,KAAK,CAAEmB,MAAM,CAAEjB,mBAAmB,CAAC,CAAC,CAExCN,SAAS,CAAC,IAAM,CACd,KAAM,CAAA4B,UAAU,CAAGT,IAAI,CAACU,KAAK,CAACZ,YAAY,CAACa,OAAO,CAAC,UAAU,CAAC,CAAC,CAC/D,GACEF,UAAU,EACVA,UAAU,CAACxB,KAAK,EACf,GAAI,CAAAU,IAAI,CAACc,UAAU,CAACP,UAAU,CAAC,CAAG,GAAI,CAAAP,IAAI,CAAC,CAAE,CAC9C,CACAJ,KAAK,CAACkB,UAAU,CAACpB,MAAM,CAAEoB,UAAU,CAACxB,KAAK,CAAE,GAAI,CAAAU,IAAI,CAACc,UAAU,CAACP,UAAU,CAAC,CAAC,CAC7E,CACF,CAAC,CAAE,CAACX,KAAK,CAAC,CAAC,CAEX,MAAO,CAAEF,MAAM,CAAEJ,KAAK,CAAEM,KAAK,CAAEa,MAAM,CAAC,CACxC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}